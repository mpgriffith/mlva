# mlva
in silico MLVA for C.diff long read assemblies.
This repository contains two scripts for performing **MLVA (Multiple-Locus Variable number tandem repeat Analysis)** from long-read genome assemblies and calculating the **STRD (Summed Tandem Repeat Difference)** between isolates.


---

## Scripts

### 1. `mlva.py` — Extract MLVA Profiles

Identifies tandem repeat loci from assemblies using primer sequences and outputs MLVA profiles.

#### Usage
```bash
python mlva.py -f assemblies/*.fasta -v primers.fasta -o mlva_profiles.csv
````

#### Positional / Optional Arguments

* `-f FASTAS [FASTAS ...], --fastas FASTAS [FASTAS ...]`
  Input genome assemblies in FASTA format. Multiple files can be provided.

* `-v PRIMER_FASTA, --primer_fasta PRIMER_FASTA`
  FASTA file containing PCR primers and tandem repeat information for MLVA loci.

* `-o OUTPUT, --output OUTPUT`
  Path to output file (comma-delimited MLVA profiles).

* `-i DIR, --verbose_output DIR`
  Optional detailed output file (e.g., repeat sequences, locus alignments) to the directory.

* `-c, --count`
  Count the actual tandem repeats directly from the assembly sequence,
  rather than estimating copy number from the distance between primers.

---

### 2. `calc_strd.py` — Calculate STRD

Calculates the **Summed Tandem Repeat Difference (STRD)** between isolates from their MLVA profiles.

#### Usage

```bash
python calc_strd.py mlva_profiles.csv -o strd_results.csv --skip_loci CDR6
```

#### Positional / Optional Arguments

* `input`
  MLVA profile table (comma-delimited, isolates × loci) generated by `mlva.py`.

* `-o OUTPUT, --output OUTPUT`
  Output file containing the STRD results (pairwise  table).

* `--skip_loci SKIP_LOCI [SKIP_LOCI ...]`
  One or more loci to exclude from STRD calculation (e.g., problematic or missing loci). CDR6 is included in the primer file but often removed from STRD calculations


---

## Primer File Format

The `--primer_fasta` file contains the PCR primers used in MLVA assays, with tandem repeat information in the header. The cd_primers.fasta in this repository contains the information needed for 8 loci: CDR4, CDR5, CDR6, CDR9, CDR48, CDR49, CDR59, and CDR60

Each header line includes:

```
>LocusNameDirection TandemRepeatSequence ExpectedProductSize
```

Followed by the primer sequence on the next line.

Example:

```fasta
>CDR4F GAGCAA 105
TTAATTGAGGGAGAATGTTAAA
>CDR4R GAGCAA 105
AAATACTTTTCCCACTTTCATAA
```

Where:

* **LocusName + F/R** → Locus name and primer orientation (F = forward, R = reverse).
* **TandemRepeatMotif** → Repeat unit sequence at that locus (e.g., `GAGCAA`).
* **ExpectedProductSize** → Expected PCR product size in base pairs.

The script uses the primer sequences to locate loci in the assemblies, and the size between the primers (defulat or the count of tandem repeat motif to calculate repeat copy numbers.

---

## Example Workflow

```bash
# Step 1: Generate MLVA profiles from assemblies
python mlva.py -f assemblies/*.fasta -v mlva_primers.fasta -o mlva_profiles.tsv

# Step 2: Calculate STRD distances
python calc_strd.py mlva_profiles.tsv -o strd_matrix.tsv
```
